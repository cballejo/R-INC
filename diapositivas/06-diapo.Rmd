---
title: "Resultados descriptivos avanzados"
subtitle: ""  
author: 
  - "Instituto Nacional de Epidemiología"
date: "13-11-2023"
output:
  xaringan::moon_reader:
    includes:
      after_body: insert-logo.html
    transition: slide
    lib_dir: libs
    css: 
     - "xaringan-themer.css"
     - "animate.min.css"
     - "fonts_mtheme.css"
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
---

layout: true
class: animated, fadeIn


```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE, htmltools.preserve.raw = FALSE)
library(xaringan)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(base_color = "#00746B", 
                  colors = c(red = "#f34213",
                             blue = '#0000ff',
                             purple = "#3e2f5b",
                             orange = "#ff8811",
                             green = "#1d771d",
                             white = "#FFFFFF"))
```

---

## Operaciones simultáneas por columnas 

.font130[
Las operaciones por columnas se refieren a la aplicación de las mismas funciones-verbos de dplyr (u otras funciones de transformación de datos) a varias columnas simultáneamente.
]

.font120[
Ejemplo, creación de múltiples columnas con **mutate()**
]
```{r,echo=F,  out.width = "20%"}
knitr::include_graphics("assets/mutate_across.PNG")
```
.font120[
Ejemplo, resumiendo múltiples columnas con **summarise()**
]
```{r,echo=F,  out.width = "20%"}
knitr::include_graphics("assets/summarise_across.PNG")
```
---
class: left, top


## across()

.font140[
Esta función es la encargada de dar soporte para las operaciones múltiples (*dplyr >= 1.0.0*)
]

.center[.font160[
across(.blue[ .cols],  .orange[ .fns],  .purple[ ...],  .green[ .names])
]]

.font140[
.blue[.cols] = columnas a transformar

.orange[.fns] = función o funciones para aplicar a cada columna de .cols

.purple[...] = argumentos adicionales de las funciones especificadas anteriormente (ejemplo: na.rm = T)

.green[.names] = nombres de las columnas de salida. Aquí, `{col}` es un marcador especial al que se le puede agregar el sufijo deseado.

]

---
# Ejemplo 

.font140[
Utilizamos `across()` para transformar el tipo de datos de POSIX a Date en las fechas de la tabla HPV en solo paso.

]

```{r, echo=F, message=FALSE, warning=FALSE}
library(tidyverse)
library(readxl)

hpv <- read_excel("assets/Informe_HPV_anonimizado.xlsx")
```

```{r, echo=T}
hpv |> 
  mutate(across(where(is.POSIXct),
                as_date)) |> 
  select(where(is.Date))
```

---
## Operaciones por filas

.font140[
Las operaciones habituales dentro de los datos ordenados se realizan en columnas, pero podemos enfrentarnos a situaciones donde necesitemos hacerlo por filas.

Estas situaciones se dan cuando necesitamos hacer resúmenes por filas (calcular la media de x, y, z) o bien llamar una función varias veces con diferentes argumentos.

Un caso particular se da con tablas pivoteadas a lo "ancho" donde las columnas pasan a ser categorías de variables y junto con esta transformación las operaciones de agregados cambian de sentido vertical a horizontal.

La función que dplyr aporta para estas tareas es `rowwise()` que es parecido al `group_by()` en cuanto a que no hace nada por sí mismo, sino que funciona como metadato que trabaja con otras funciones.
]

---
## Ejemplo con tabla pivoteada

```{r, echo=F, message=F, warning=F}
tabla <- read_csv2("assets/tabla.csv")

tabla |> 
DT::datatable(
  fillContainer = F, options = list(pageLength = 6))
```

---
## Ejemplo con tabla pivoteada

.font140[
Utilizamos `rowwise()` para combinar con `summarise()` y lograr hacer un resumen como la sumatoria de variables a nivel filas. Finalmente contabilizamos por columna.
]

```{r}
tabla |> 
  rowwise() |> 
  summarise(cantidad = sum(c(Quimioterapia, Radioterapia, Cirugía, 
                             Hormonoterapia, Otro, `Control sintomático diferente a opioides`))) |> 
  count(cantidad)
```

---
## c_across()

.font140[
La función `c_across()` esta diseñada para facilitar los resúmenes por fila.

Por ejemplo, para el mismo ejemplo anterior podemos simplificar la sumatoria haciendo:
]

```{r}
tabla |> 
  rowwise() |> 
  mutate(cantidad = sum(c_across(Quimioterapia:`Control sintomático diferente a opioides`))) |> 
  count(cantidad)
```

---
## Estadistica descriptiva con rstatix

.font140[
El paquete **rstatix** provee un marco simple e intuitivo compatible con el uso de tuberías, coherente con la filosofía de diseño "tidyverse", para realizar pruebas estadísticas descriptivas básicas y otras más avanzadas de inferencia y modelado.

Las funciones relacionadas con la inferencia estadística, como t-test, ANOVAS, correlaciones y tamaños de efecto, así como también valores p ajustados o agregados de etiquetas de significación no serán explicados en este curso pero aquellxs estudiantes que les interese profundizar y utilizarlas le pueden sacar un provecho muy útil a este paquete. 


]

---

```{r}
library(rstatix)

hpv |> 
  get_summary_stats(edad, type = "robust")
```

```{r}
hpv |> 
 freq_table(resultado_hpv, metodo)
```

---
## gtsummary

.font140[]


---
## Exportación de tablas a word

flextable

---